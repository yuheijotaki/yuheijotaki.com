---
title: 'Nuxt.js + AWS ECS Fargate ãã®1ï¼ˆNuxt.jsã‚¢ãƒ—ãƒªä½œæˆã€œECRãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ï¼‰'
description: ''
publishDate: 03/21/2021 16:57:36

---
<p><span itemscope itemtype="http://schema.org/Photograph"><img src="/images/hatena/20210321165648.png" alt="f:id:jotaki:20210321165648p:plain" title="" class="hatena-fotolife" itemprop="image"></span></p>

<p><a href="https://www.ragate.co.jp/blog/articles/1947">ãƒˆãƒ¬ãƒ³ãƒ‰ã®Vuejs/Nuxtã‚’Aws ECS, Fargateã§SSRã€è©³ç´°è§£èª¬ã—ã¾ã™ğŸš€</a> ã®è¨˜äº‹ã‚’å‚è€ƒã«é€²ã‚ã¦ã¿ã‚‹ã€‚</p>

<h1>ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ ä½¿ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³</h1>

<ul>
<li>Node.js: 12.11.0</li>
<li>AWS CLI: 2.1.31</li>
</ul>


<h1>Nuxt.js ã‚¢ãƒ—ãƒªã®ä½œæˆ</h1>

<p>create nuxt-app ã§ä½œæˆã—ã¾ã™ã€‚</p>

<pre class="code bash" data-lang="bash" data-unlink>$ yarn create nuxt-app nuxt-fargate_app
yarn create v1.13.0
create-nuxt-app v3.6.0
...</pre>


<p>è¨­å®šé …ç›®ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚<br />
Fargateã§å‹•ã‹ã™ã®ã§Rendering modeã¯Universalã‚’æŒ‡å®šã€‚<br />
ã—ã°ã‚‰ãè§¦ã£ã¦ãªã„ã¨ç´°ã€…å¤‰ã‚ã‚Šã¾ã™ã­ã€‚ã€‚</p>

<pre class="code bash" data-lang="bash" data-unlink>? Project name: nuxt-fargate_app
? Programming language: JavaScript
? Package manager: Npm
? UI framework: None
? Nuxt.js modules: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)
? Linting tools: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)
? Testing framework: None
? Rendering mode: Universal (SSR / SSG)
? Deployment target: Server (Node.js hosting)
? Development tools: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)
? What is your GitHub username? yuhei jotaki
? Version control system: Git</pre>


<h1>Dockerfile ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆ</h1>

<p>Docker å‘ã‘ã« package.json ã® scripts ã‚’èª¿æ•´ã™ã‚‹ã€‚</p>

<pre class="code lang-json" data-lang="json" data-unlink>  ...
  &quot;<span class="synStatement">scripts</span>&quot;: <span class="synSpecial">{</span>
    &quot;<span class="synStatement">dev</span>&quot;: &quot;<span class="synConstant">HOST=0.0.0.0 PORT=3000 nuxt</span>&quot;,
    &quot;<span class="synStatement">build</span>&quot;: &quot;<span class="synConstant">nuxt build</span>&quot;,
    &quot;<span class="synStatement">start</span>&quot;: &quot;<span class="synConstant">HOST=0.0.0.0 PORT=3000 nuxt start</span>&quot;,
    &quot;<span class="synStatement">generate</span>&quot;: &quot;<span class="synConstant">nuxt generate</span>&quot;
  <span class="synSpecial">}</span>,
  ...
</pre>


<p>Dockerfile ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã—ã¦ä¸‹è¨˜ã®ã‚ˆã†ã«ã™ã‚‹ã€‚<br />
Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ <a href="https://hub.docker.com/_/node/">å…¬å¼ã®ã‚¤ãƒ¡ãƒ¼ã‚¸</a> ã‚’å‚è€ƒã«ã™ã‚‹ã€‚</p>

<pre class="code" data-lang="" data-unlink>FROM node:12

RUN mkdir -p /var/www/nuxt-fargate_app
WORKDIR /var/www/nuxt-fargate_app
COPY ./ /var/www/nuxt-fargate_app
RUN npm run build

EXPOSE 3000

ENTRYPOINT [&#34;npm&#34;, &#34;run&#34;, &#34;start&#34;]</pre>


<p>æ¬¡ã«Dockerã‚¢ãƒ—ãƒªã‚’runningã«ã™ã‚‹ã€‚<br />
ãã®å¾Œãƒ“ãƒ«ãƒ‰ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½œæˆã§ãã¦ã„ã‚‹ã‹ç¢ºèªã€‚</p>

<pre class="code bash" data-lang="bash" data-unlink>$ docker build -t nuxt-fargate_app .
...
Successfully tagged nuxt-fargate_app:latest</pre>




<pre class="code bash" data-lang="bash" data-unlink>$ docker images
REPOSITORY                 TAG              IMAGE ID       CREATED          SIZE
nuxt-fargate_app           latest           XXXXX   39 seconds ago   1.03GB
...</pre>


<p>èµ·å‹•ã—ã¦ã¿ã‚‹ã€‚<br />
ã“ã“ã¯ã‚ã¾ã‚Šåˆ†ã‹ã£ã¦ãªã„ã§ã™ãŒã€ 0.0.0.0:3000 ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããŸã®ã§OKãªã®ã‹ãª</p>

<pre class="code bash" data-lang="bash" data-unlink>$ docker run -d -p 3000:3000 nuxt-fargate_app
...
$ docker ps
CONTAINER ID   IMAGE              COMMAND           CREATED          STATUS          PORTS                    NAMES
61f86de41a7a   nuxt-fargate_app   &#34;npm run start&#34;   21 seconds ago   Up 19 seconds   0.0.0.0:3000-&gt;3000/tcp   amazing_yalow</pre>


<h1>ECRã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹</h1>

<p>AWS ECR > ãƒªãƒã‚¸ãƒˆãƒªä½œæˆã‚’ã™ã‚‹ã€‚<br />
ä»Šå›ã¯ <code>nuxt-fargate_app</code> ã¨ã„ã†ãƒªãƒã‚¸ãƒˆãƒªåã«ã—ã¾ã—ãŸã€‚</p>

<p>ãã®å¾Œã‚³ãƒãƒ³ãƒ‰ã§èªè¨¼ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚<br />
ãã‚Œãã‚Œã¤ã¾ã¥ãã¾ã—ãŸãŒã€èªè¨¼ã¯ <code>get-login</code> ã¯ç¾åœ¨éæ¨å¥¨ã®ãŸã‚ <code>get-login-password</code> ãŒè‰¯ã„ã¨ã®ã“ã¨ã§ <a href="https://docs.aws.amazon.com/ja_jp/AmazonECR/latest/userguide/getting-started-cli.html">Amazon ECR ã§ã® AWS CLI ã®ä½¿ç”¨ - Amazon ECR</a> ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚<br />
â€» å¾Œã€…æŒ¯ã‚Šè¿”ã‚‹ã¨ã€ECRã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†… > ãƒªãƒã‚¸ãƒˆãƒª > è©²å½“ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ > ãƒ—ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã®è¡¨ç¤º ã«ã‚‚ã‚³ãƒãƒ³ãƒ‰ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚</p>

<pre class="code bash" data-lang="bash" data-unlink># &lt;profile-name&gt;: ~/.aws/credentials ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰
# &lt;app-name&gt;: nuxt-fargate_app
# &lt;aws-region-name&gt;: ap-northeast-1
# &lt;aws-account-id&gt;: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID

# ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
$ export AWS_DEFAULT_PROFILE=&lt;profile-name&gt;

# èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å¯¾ã—ã¦ Docker ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èªè¨¼ã—ã¾ã™ã€‚
$ aws ecr get-login-password | docker login --username AWS --password-stdin https://&lt;aws-account-id&gt;.dkr.ecr.&lt;aws-region-name&gt;.amazonaws.com

# Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
$ docker build -t &lt;app-name&gt;:latest .

# æ§‹ç¯‰ãŒå®Œäº†ã—ãŸã‚‰ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã§ãã‚‹ã‚ˆã†ã«ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¿ã‚°ã‚’ä»˜ã‘ã¾ã™ã€‚
$ docker tag &lt;app-name&gt;:latest &lt;aws-account-id&gt;.dkr.ecr.&lt;aws-region-name&gt;.amazonaws.com/&lt;app-name&gt;:latest

# æ–°ã—ãä½œæˆã—ãŸ AWS ãƒªãƒã‚¸ãƒˆãƒªã«ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
$ docker push &lt;aws-account-id&gt;.dkr.ecr.&lt;aws-region-name&gt;.amazonaws.com/&lt;app-name&gt;:latest</pre>


<p>ä»¥ä¸Šã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã§ãã¾ã—ãŸã€‚</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="/images/hatena/20210321165218.png" alt="f:id:jotaki:20210321165218p:plain" title="" class="hatena-fotolife" itemprop="image"></span></p>

<p>AWSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚„CLIæœ€è¿‘ã‚ã¾ã‚Šè§¦ã‚‹æ©Ÿä¼šãŒãªã‹ã£ãŸã§ã™ãŒã€CLIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆç­‰ã€…ã¤ã¾ã¥ãã¨ã“ã‚ãŒå¤šã‹ã£ãŸã§ã™ã€‚<br />
æ­£ç›´ã‚ã¾ã‚Šåˆ†ã‹ã£ã¦ãªã„éƒ¨åˆ†ã‚‚å¤šã„ã§ã™ãŒã€æ¬¡å›ä»¥é™ã¯ECSã®è¨­å®šã«ãªã‚Šãã†ã§ã™ã®ã§å¼•ãç¶šãæ›´æ–°ã§ããŸã‚‰ã¨æ€ã„ã¾ã™ã€‚</p>

